<Window x:Class="TgdSoundboard.Views.ReplaysWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Saved Replays"
        Height="500" Width="600"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource ThemeBgPrimaryBrush}"
        TextElement.Foreground="{DynamicResource ThemeTextPrimaryBrush}"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource ThemeHeaderGradient}" Padding="20,16">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left">
                    <TextBlock Text="SAVED REPLAYS" FontSize="18" FontWeight="Bold"/>
                    <TextBlock x:Name="FolderPathText"
                               Text="Loading..."
                               Foreground="{DynamicResource ThemeTextMutedBrush}"
                               FontSize="11"
                               Margin="0,4,0,0"/>
                </StackPanel>
                <Button DockPanel.Dock="Right"
                        Click="Refresh_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Foreground="{DynamicResource ThemeTextPrimaryBrush}"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Refresh" VerticalAlignment="Center"/>
                        <TextBlock Text="Refresh" Margin="6,0,0,0"/>
                    </StackPanel>
                </Button>
            </DockPanel>
        </Border>

        <!-- Replay List -->
        <Border Grid.Row="1" Margin="16">
            <Grid>
                <!-- Empty State -->
                <StackPanel x:Name="EmptyState"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="Collapsed">
                    <materialDesign:PackIcon Kind="VideoOff"
                                             Width="48" Height="48"
                                             HorizontalAlignment="Center"
                                             Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                    <TextBlock Text="No replays found"
                               HorizontalAlignment="Center"
                               Margin="0,12,0,4"
                               Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                    <TextBlock Text="Save some replays in Streamlabs to see them here"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource ThemeTextMutedBrush}"
                               FontSize="11"/>
                </StackPanel>

                <!-- Replay List -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="ReplayList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource ThemeBgSecondaryBrush}"
                                        CornerRadius="8"
                                        Margin="0,0,0,8"
                                        Padding="12"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="Replay_Click">
                                    <Border.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="Play" Click="ContextPlay_Click">
                                                <MenuItem.Icon>
                                                    <materialDesign:PackIcon Kind="Play"/>
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <Separator/>
                                            <MenuItem Header="Rename" Click="ContextRename_Click">
                                                <MenuItem.Icon>
                                                    <materialDesign:PackIcon Kind="Pencil"/>
                                                </MenuItem.Icon>
                                            </MenuItem>
                                            <MenuItem Header="Delete" Click="ContextDelete_Click">
                                                <MenuItem.Icon>
                                                    <materialDesign:PackIcon Kind="Delete"/>
                                                </MenuItem.Icon>
                                            </MenuItem>
                                        </ContextMenu>
                                    </Border.ContextMenu>
                                    <DockPanel>
                                        <!-- Thumbnail/Icon -->
                                        <Border DockPanel.Dock="Left"
                                                Width="80" Height="45"
                                                CornerRadius="4"
                                                Background="{DynamicResource ThemeBgTertiaryBrush}"
                                                Margin="0,0,12,0">
                                            <materialDesign:PackIcon Kind="Video"
                                                                     Width="24" Height="24"
                                                                     HorizontalAlignment="Center"
                                                                     VerticalAlignment="Center"
                                                                     Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                                        </Border>

                                        <!-- Play Button -->
                                        <Button DockPanel.Dock="Right"
                                                Click="PlayReplay_Click"
                                                Tag="{Binding FilePath}"
                                                Style="{StaticResource MaterialDesignFloatingActionMiniButton}"
                                                Background="{DynamicResource ThemeAccentBrush}"
                                                VerticalAlignment="Center"
                                                ToolTip="Play in Streamlabs">
                                            <materialDesign:PackIcon Kind="Play" Width="20" Height="20"/>
                                        </Button>

                                        <!-- Info -->
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{Binding FileName}"
                                                       FontSize="14"
                                                       FontWeight="Medium"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                <TextBlock Text="{Binding CreatedTime, StringFormat='{}{0:MMM d, yyyy h:mm tt}'}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                                                <TextBlock Text=" â€¢ "
                                                           FontSize="11"
                                                           Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                                                <TextBlock Text="{Binding FileSizeText}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource ThemeTextMutedBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </DockPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Footer -->
        <Border Grid.Row="2"
                Background="{DynamicResource ThemeBgSecondaryBrush}"
                Padding="16,12">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="InformationOutline"
                                             Foreground="{DynamicResource ThemeAccentBrush}"
                                             VerticalAlignment="Center"
                                             Margin="0,0,8,0"/>
                    <TextBlock Text="Click a replay to play it in Streamlabs"
                               Foreground="{DynamicResource ThemeTextSecondaryBrush}"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <Button DockPanel.Dock="Right"
                        Click="OpenFolder_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Foreground="{DynamicResource ThemeTextSecondaryBrush}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="FolderOpen" VerticalAlignment="Center"/>
                        <TextBlock Text="Open Folder" Margin="6,0,0,0"/>
                    </StackPanel>
                </Button>
            </DockPanel>
        </Border>
    </Grid>
</Window>
